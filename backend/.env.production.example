# MindFlow Production Environment Configuration
# Copy this file to .env.production and update with your actual values
# Last Updated: 2025-11-02
# Version: 13.0 (Phase 9B Complete)

# =============================================================================
# DOMAIN & API CONFIGURATION
# =============================================================================
# Your production domain (must have valid SSL certificate)
MINDFLOW_DOMAIN=tasks.yourdomain.com

# Base API URL (should match your domain with HTTPS)
API_BASE_URL=https://tasks.yourdomain.com

# OAuth issuer (must match API_BASE_URL for token validation)
OAUTH_ISSUER=https://tasks.yourdomain.com

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================
# PostgreSQL connection string for production
# Format: postgresql+asyncpg://user:password@host:port/database
DATABASE_URL=postgresql+asyncpg://mindflow:CHANGE_ME_STRONG_PASSWORD@localhost:5432/mindflow_prod

# Database pool settings (adjust based on server resources)
DB_POOL_SIZE=20              # Number of persistent connections
DB_MAX_OVERFLOW=10           # Additional connections when pool is full
DB_POOL_TIMEOUT=30           # Seconds to wait for available connection
DB_POOL_RECYCLE=3600         # Recycle connections after 1 hour

# =============================================================================
# OAUTH 2.1 & JWT CONFIGURATION
# =============================================================================
# RS256 Private Key (generate with: openssl genrsa -out private.pem 2048)
# IMPORTANT: Keep this secret and never commit to version control
JWT_PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----
REPLACE_WITH_YOUR_PRIVATE_KEY
-----END RSA PRIVATE KEY-----"

# RS256 Public Key (generate with: openssl rsa -in private.pem -outform PEM -pubout -out public.pem)
JWT_PUBLIC_KEY="-----BEGIN PUBLIC KEY-----
REPLACE_WITH_YOUR_PUBLIC_KEY
-----END PUBLIC KEY-----"

# JWT token lifetimes
ACCESS_TOKEN_EXPIRE_MINUTES=60        # Access token valid for 1 hour
REFRESH_TOKEN_EXPIRE_DAYS=90          # Refresh token valid for 90 days

# OAuth allowed redirect URIs (comma-separated)
ALLOWED_REDIRECT_URIS=https://chatgpt.com/auth/callback,https://chat.openai.com/auth/callback

# =============================================================================
# SECURITY SETTINGS
# =============================================================================
# Secret key for session management and CSRF protection
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
SECRET_KEY=CHANGE_ME_GENERATE_WITH_SECRETS_TOKEN_URLSAFE_32

# CORS allowed origins (comma-separated)
CORS_ORIGINS=https://chatgpt.com,https://chat.openai.com

# Rate limiting (requests per minute per user)
RATE_LIMIT_PER_MINUTE=60

# =============================================================================
# ENVIRONMENT & DEBUG
# =============================================================================
# Environment mode (production or development)
ENVIRONMENT=production

# Debug mode (MUST be false in production)
DEBUG=false

# Log level (INFO, WARNING, ERROR, CRITICAL)
LOG_LEVEL=INFO

# =============================================================================
# PERFORMANCE SETTINGS
# =============================================================================
# Uvicorn workers (set to number of CPU cores)
WORKERS=4

# Worker timeout (seconds)
TIMEOUT=60

# Keep-alive timeout (seconds)
KEEP_ALIVE=5

# =============================================================================
# MCP SERVER CONFIGURATION
# =============================================================================
# MCP server enabled (true/false)
MCP_ENABLED=true

# MCP cache TTL (seconds) - how long to cache component embeddings
MCP_CACHE_TTL=3600

# MCP max retries for failed tool calls
MCP_MAX_RETRIES=3

# =============================================================================
# CHATGPT APPS SDK CONFIGURATION
# =============================================================================
# TaskWidget bundle path (relative to mcp_server/)
WIDGET_BUNDLE_PATH=assets/taskwidget.js

# Component cache enabled (reduces response times)
COMPONENT_CACHE_ENABLED=true

# =============================================================================
# MONITORING & OBSERVABILITY (Optional)
# =============================================================================
# Sentry DSN for error tracking (optional)
# SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id

# Sentry environment
# SENTRY_ENVIRONMENT=production

# Sentry traces sample rate (0.0 to 1.0)
# SENTRY_TRACES_SAMPLE_RATE=0.1

# =============================================================================
# BACKUP & MAINTENANCE (Optional)
# =============================================================================
# Automated backup enabled
# BACKUP_ENABLED=true

# Backup S3 bucket (if using S3 for backups)
# BACKUP_S3_BUCKET=mindflow-backups

# Backup frequency (cron expression: daily at 2 AM)
# BACKUP_SCHEDULE="0 2 * * *"

# =============================================================================
# NOTIFICATIONS (Optional)
# =============================================================================
# Email notifications (optional)
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_USER=noreply@yourdomain.com
# SMTP_PASSWORD=your-app-password
# SMTP_FROM_EMAIL=MindFlow <noreply@yourdomain.com>

# =============================================================================
# PRODUCTION CHECKLIST
# =============================================================================
# Before going live, ensure:
# □ All CHANGE_ME values replaced with secure values
# □ JWT keys generated with OpenSSL (RS256)
# □ Database URL points to production database
# □ DEBUG=false
# □ ENVIRONMENT=production
# □ SSL certificate installed and valid
# □ Domain DNS configured correctly
# □ CORS_ORIGINS restricted to ChatGPT domains only
# □ Rate limiting configured appropriately
# □ Backup strategy in place
# □ Monitoring configured (Sentry recommended)
# □ Health check endpoint responding: https://your-domain.com/health
# □ OAuth discovery endpoint responding: https://your-domain.com/.well-known/oauth-authorization-server
# □ MCP endpoint responding: https://your-domain.com/mcp
# □ All 97 tests passing before deployment
# □ Load testing completed
# □ Security scan completed
# □ Team trained on deployment procedures
# □ Rollback plan documented and tested

# =============================================================================
# SECURITY NOTES
# =============================================================================
# 1. NEVER commit this file with real values to version control
# 2. Use environment-specific .env files (.env.production, .env.staging)
# 3. Rotate JWT keys every 90 days
# 4. Use strong passwords (minimum 32 characters)
# 5. Enable database connection encryption (SSL/TLS)
# 6. Review and update CORS_ORIGINS regularly
# 7. Monitor rate limiting logs for abuse patterns
# 8. Keep all dependencies updated with security patches
# 9. Enable database query logging in development, disable in production
# 10. Use read-only database users where possible

# =============================================================================
# TROUBLESHOOTING
# =============================================================================
# If deployment fails:
# 1. Check logs: journalctl -u mindflow -f
# 2. Verify database connection: psql $DATABASE_URL
# 3. Test OAuth endpoints: curl https://your-domain.com/.well-known/oauth-authorization-server
# 4. Verify MCP server: curl https://your-domain.com/mcp
# 5. Check firewall rules: ufw status
# 6. Verify SSL certificate: openssl s_client -connect your-domain.com:443
# 7. Review nginx configuration: nginx -t
# 8. Check process status: systemctl status mindflow
# 9. Verify environment variables: env | grep MINDFLOW
# 10. Run health check: curl https://your-domain.com/health

# =============================================================================
# SUPPORT
# =============================================================================
# Documentation: https://github.com/yourorg/mindflow/tree/main/docs
# Connection Guide: backend/docs/CHATGPT-CONNECTION-GUIDE.md
# Setup Guide: docs/APPS-SDK-SETUP.md
# Issues: https://github.com/yourorg/mindflow/issues

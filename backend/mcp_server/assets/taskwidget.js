import e,{Component as $,useMemo as x,useState as w}from"react";var s=class extends Error{constructor(n){super(n),this.name="AppsSDKError"}},d=class d{constructor(){if(!this.isAvailable())throw new s("window.openai not available. This component must run in ChatGPT.")}static getInstance(){return d.instance||(d.instance=new d),d.instance}isAvailable(){return typeof window<"u"&&!!window.openai}get theme(){return window.openai.theme}getToolOutput(){let n=window.openai.toolOutput;if(!n)throw new s("No tool output available");return n.output}async callTool(n){try{return await window.openai.callTool(n)}catch(o){throw new s(`Failed to call tool "${n.name}": ${o}`)}}async saveState(n){try{await window.openai.setWidgetState(n)}catch(o){throw new s(`Failed to save widget state: ${o}`)}}async loadState(){try{return await window.openai.getWidgetState()}catch(n){throw new s(`Failed to load widget state: ${n}`)}}getMetadata(){return window.openai.toolOutput?._meta||null}};d.instance=null;var y=d;function h(){return y.getInstance()}var E={1:"Very Low",2:"Low",3:"Medium",4:"High",5:"Urgent"},S=class extends ${constructor(n){super(n),this.state={hasError:!1,error:null}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,o){console.error("TaskWidget Error:",n,o)}render(){if(this.state.hasError){let o=h().theme==="dark",t={bg:o?"#1a1a1a":"#ffffff",text:o?"#ffffff":"#000000",textSecondary:o?"#b0b0b0":"#666666",border:o?"#404040":"#e0e0e0",error:o?"#ff6b6b":"#d32f2f",errorBg:o?"rgba(255, 107, 107, 0.1)":"rgba(211, 47, 47, 0.05)"};return e.createElement("div",{style:{fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif",backgroundColor:t.bg,border:`1px solid ${t.border}`,borderRadius:"8px",padding:"16px",maxWidth:"600px",width:"100%"}},e.createElement("div",{style:{padding:"12px",backgroundColor:t.errorBg,borderRadius:"6px",border:`1px solid ${t.error}`}},e.createElement("div",{style:{fontSize:"16px",fontWeight:600,color:t.error,marginBottom:"8px"}},"\u26A0\uFE0F Error Loading Task"),e.createElement("p",{style:{fontSize:"14px",color:t.text,lineHeight:1.5,margin:"0"}},"Failed to render task widget. Please try refreshing or contact support."),this.state.error&&e.createElement("p",{style:{fontSize:"12px",color:t.textSecondary,marginTop:"8px",fontFamily:"monospace"}},this.state.error.message)))}return this.props.children}},I=()=>{let l=h(),o=l.theme==="dark",{task:t,score:z,reasoning:g}=x(()=>l.getToolOutput(),[]),[c,k]=w(!1),[p,v]=w(!1),[T,u]=w(null),D=async()=>{try{k(!0),u(null),await l.callTool({name:"complete_task",arguments:{task_id:t.id}}),await window.openai.sendFollowUpMessage({prompt:`Task "${t.title}" completed! What should I work on next?`})}catch(i){console.error("Failed to complete task:",i),u(i instanceof Error?i.message:"Failed to complete task. Please try again.")}finally{k(!1)}},F=async i=>{try{v(!0),u(null),await l.callTool({name:"snooze_task",arguments:{task_id:t.id,hours:i}}),await window.openai.sendFollowUpMessage({prompt:`Task "${t.title}" snoozed for ${i} hours. Show me the next task.`})}catch(a){console.error("Failed to snooze task:",a),u(a instanceof Error?a.message:"Failed to snooze task. Please try again.")}finally{v(!1)}},C=x(()=>{if(!t.due_date)return null;let i=new Date(t.due_date),a=new Date,m=i.getTime()-a.getTime(),f=Math.ceil(m/(1e3*60*60*24));return f<0?`Overdue by ${Math.abs(f)}d`:f===0?"Due today":f===1?"Due tomorrow":f<=7?`Due in ${f}d`:`Due ${i.toLocaleDateString()}`},[t.due_date]),W=x(()=>{if(!t.effort_estimate_minutes)return null;let i=t.effort_estimate_minutes;if(i<60)return`${i}m`;let a=Math.floor(i/60),m=i%60;return m>0?`${a}h ${m}m`:`${a}h`},[t.effort_estimate_minutes]),_=x(()=>t.due_date?new Date(t.due_date)<new Date:!1,[t.due_date]),b=x(()=>{let i={light:{5:{bg:"#ffebee",text:"#c62828",border:"#ef5350"},4:{bg:"#fff3e0",text:"#e65100",border:"#ff9800"},3:{bg:"#e3f2fd",text:"#1565c0",border:"#2196f3"},2:{bg:"#f3e5f5",text:"#6a1b9a",border:"#9c27b0"},1:{bg:"#f1f8e9",text:"#558b2f",border:"#8bc34a"}},dark:{5:{bg:"#4a1616",text:"#ffcdd2",border:"#e57373"},4:{bg:"#4a3116",text:"#ffe0b2",border:"#ffb74d"},3:{bg:"#162a4a",text:"#bbdefb",border:"#64b5f6"},2:{bg:"#391646",text:"#e1bee7",border:"#ba68c8"},1:{bg:"#2d4a16",text:"#dcedc8",border:"#aed581"}}};return o?i.dark[t.priority]:i.light[t.priority]},[t.priority,o]),r={bg:o?"#1a1a1a":"#ffffff",text:o?"#ffffff":"#000000",textSecondary:o?"#b0b0b0":"#666666",border:o?"#404040":"#e0e0e0",accent:"#007aff",scoreBg:o?"rgba(0, 122, 255, 0.1)":"rgba(0, 122, 255, 0.05)",scoreBorder:o?"rgba(0, 122, 255, 0.2)":"rgba(0, 122, 255, 0.15)"};return e.createElement("div",{style:{fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif",backgroundColor:r.bg,border:`1px solid ${r.border}`,borderRadius:"8px",padding:"16px",maxWidth:"600px",width:"100%"}},e.createElement("div",{style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 12px",borderRadius:"12px",fontSize:"12px",fontWeight:600,backgroundColor:b.bg,color:b.text,border:`1px solid ${b.border}`}},e.createElement("span",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:b.border}}),E[t.priority]),e.createElement("h3",{style:{fontSize:"18px",fontWeight:600,color:r.text,margin:"12px 0 8px 0",lineHeight:1.4}},t.title),t.description&&e.createElement("p",{style:{fontSize:"14px",color:r.textSecondary,lineHeight:1.5,margin:"0 0 12px 0"}},t.description),e.createElement("div",{style:{display:"flex",flexWrap:"wrap",gap:"12px",fontSize:"13px",color:r.textSecondary,marginBottom:"12px"}},C&&e.createElement("div",{style:{display:"flex",alignItems:"center",gap:"4px",color:_?o?"#ffcdd2":"#c62828":r.textSecondary,fontWeight:_?600:400}},e.createElement("span",null,"\u{1F4C5}"),e.createElement("span",null,C)),W&&e.createElement("div",{style:{display:"flex",alignItems:"center",gap:"4px"}},e.createElement("span",null,"\u23F1\uFE0F"),e.createElement("span",null,W)),t.tags&&e.createElement("div",{style:{display:"flex",alignItems:"center",gap:"4px"}},e.createElement("span",null,"\u{1F3F7}\uFE0F"),e.createElement("span",null,t.tags))),e.createElement("div",{style:{marginTop:"12px",padding:"12px",backgroundColor:r.scoreBg,borderRadius:"6px",border:`1px solid ${r.scoreBorder}`}},e.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"}},e.createElement("span",{style:{fontSize:"12px",fontWeight:600,color:r.accent,textTransform:"uppercase",letterSpacing:"0.5px"}},"AI Score"),e.createElement("span",{style:{fontSize:"20px",fontWeight:700,color:r.accent}},z.toFixed(1))),g.recommendation&&e.createElement("p",{style:{fontSize:"13px",color:r.text,lineHeight:1.5,margin:"8px 0 0 0"}},g.recommendation),e.createElement("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:"8px",marginTop:"8px",fontSize:"12px"}},e.createElement("div",{style:{display:"flex",justifyContent:"space-between",padding:"4px 0"}},e.createElement("span",{style:{color:r.textSecondary}},"Priority:"),e.createElement("span",{style:{fontWeight:600,color:r.text}},g.priority_score)),e.createElement("div",{style:{display:"flex",justifyContent:"space-between",padding:"4px 0"}},e.createElement("span",{style:{color:r.textSecondary}},"Urgency:"),e.createElement("span",{style:{fontWeight:600,color:r.text}},g.deadline_urgency.toFixed(1))),e.createElement("div",{style:{display:"flex",justifyContent:"space-between",padding:"4px 0"}},e.createElement("span",{style:{color:r.textSecondary}},"Effort:"),e.createElement("span",{style:{fontWeight:600,color:r.text}},g.effort_bonus)))),T&&e.createElement("div",{style:{marginTop:"12px",padding:"12px",backgroundColor:o?"rgba(255, 107, 107, 0.1)":"rgba(211, 47, 47, 0.05)",borderRadius:"6px",border:`1px solid ${o?"#ff6b6b":"#d32f2f"}`}},e.createElement("div",{style:{display:"flex",alignItems:"flex-start",gap:"8px"}},e.createElement("span",{style:{fontSize:"16px"}},"\u26A0\uFE0F"),e.createElement("div",{style:{flex:1}},e.createElement("div",{style:{fontSize:"14px",fontWeight:600,color:o?"#ff6b6b":"#d32f2f",marginBottom:"4px"}},"Action Failed"),e.createElement("p",{style:{fontSize:"13px",color:r.text,lineHeight:1.5,margin:"0"}},T)),e.createElement("button",{onClick:()=>u(null),style:{background:"none",border:"none",color:r.textSecondary,cursor:"pointer",padding:"0",fontSize:"18px",lineHeight:1},"aria-label":"Dismiss error"},"\xD7"))),e.createElement("div",{style:{marginTop:"16px",display:"flex",gap:"8px",flexWrap:"wrap"}},e.createElement("button",{onClick:D,disabled:c,style:{flex:"1 1 auto",minWidth:"120px",padding:"10px 16px",backgroundColor:c?r.border:r.accent,color:"#ffffff",border:"none",borderRadius:"6px",fontSize:"14px",fontWeight:600,cursor:c?"not-allowed":"pointer",opacity:c?.6:1,transition:"all 0.2s"}},c?"Completing...":"\u2713 Complete Task"),e.createElement("button",{onClick:()=>F(3),disabled:p,style:{flex:"1 1 auto",minWidth:"120px",padding:"10px 16px",backgroundColor:p?r.border:"transparent",color:p?r.textSecondary:r.text,border:`1px solid ${r.border}`,borderRadius:"6px",fontSize:"14px",fontWeight:600,cursor:p?"not-allowed":"pointer",opacity:p?.6:1,transition:"all 0.2s"}},p?"Snoozing...":"\u23F0 Snooze 3h")))},O=()=>e.createElement(S,null,e.createElement(I,null));export{y as AppsSDK,s as AppsSDKError,O as TaskWidget,h as getSDK};
